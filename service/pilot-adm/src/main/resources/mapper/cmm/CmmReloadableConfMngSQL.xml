<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mgkim.service.adm.cmm.mapper.CmmReloadableConfMngMapper">

  <select id="selectReloadStateList" parameterType="CmmReloadableConfVO" resultType="CmmReloadableConfVO">
    SELECT 
           APP_CD
         , HOSTNAME
         , APP_ID
         , CONF_ID
         , CONF_STCD
         , APLI_DTTM
         , APLI_RDTTM
         , FIRST_REGIR_NO
         , FIRST_REGI_DTTM
         , LAST_MODFR_NO
         , LAST_MODF_DTTM
      FROM MGCB401TS /* MGCB_reloadable-config상태 */
     WHERE APP_CD = #{appCd}
       AND APP_ID = #{appId}
       AND HOSTNAME = #{hostname}
  </select>

  <update id="updateReloadState" parameterType="CmmReloadableConfVO">
    UPDATE
      MGCB401TS /* MGCB_reloadable-config상태 */ SET
           CONF_STCD = #{confStcd}
         , APLI_DTTM = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
         , APLI_RDTTM = null
         , LAST_MODF_DTTM = SYSDATE
     WHERE APP_CD = #{appCd}
       AND APP_ID = #{appId}
       AND HOSTNAME = #{hostname}
       AND CONF_ID = #{confId}
  </update>

  <delete id="deleteReloadStateForReset" parameterType="CmmReloadableConfVO">
    DELETE
      FROM MGCB401TS /* MGCB_reloadable-config상태 */
     WHERE APP_CD = #{appCd}
       AND APP_ID = #{appId}
       AND HOSTNAME = #{hostname}
  </delete>

  <update id="updateReloadStateForReset" parameterType="CmmReloadableConfVO">
    MERGE
     INTO MGCB401TS /* MGCB_reloadable-config상태 */
    USING DUAL
       ON (APP_CD = #{appCd}
          AND APP_ID = #{appId}
          AND HOSTNAME = #{hostname}
          AND CONF_ID = #{confId})
     WHEN MATCHED THEN
       UPDATE SET
           CONF_STCD = '00'
         , APLI_DTTM = null
         , APLI_RDTTM = null
         , LAST_MODFR_NO = 'SYSTEM'
         , LAST_MODF_DTTM = SYSDATE
     WHEN NOT MATCHED THEN
       INSERT (
           APP_CD
         , APP_ID
         , HOSTNAME
         , CONF_ID
         , CONF_STCD
         , APLI_DTTM
         , APLI_RDTTM
         , FIRST_REGIR_NO
         , FIRST_REGI_DTTM
         , LAST_MODFR_NO
         , LAST_MODF_DTTM
       ) VALUES (
           #{appCd}
         , #{appId}
         , #{hostname}
         , #{confId}
         , '00'
         , null
         , null
         , 'SYSTEM'
         , SYSDATE
         , 'SYSTEM'
         , SYSDATE
       )
  </update>

</mapper>